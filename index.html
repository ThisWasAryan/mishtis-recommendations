<!DOCTYPE html>
<html lang="en" data-theme="dark">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Mishti's Recommendations</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.css" />
    <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.9.4/leaflet.js"></script>
    <style>
        :root {
            color-scheme: dark;
            --bg: #0b1020;
            --glass: rgba(20, 27, 47, 0.42);
            --glass-strong: rgba(16, 22, 40, 0.56);
            --surface: rgba(28, 37, 62, 0.42);
            --border: rgba(180, 199, 240, 0.24);
            --border-soft: rgba(180, 199, 240, 0.14);
            --text: #f4f8ff;
            --text-soft: #b2bfdc;
            --accent: #5ba2ff;
            --accent-strong: #3f84ff;
            --success: #1ec68e;
            --danger: #ff687f;
            --shadow: 0 20px 45px rgba(7, 9, 18, 0.45);
            --radius: 14px;
            --blur: 18px;
        }

        [data-theme="light"] {
            color-scheme: light;
            --bg: #e7eefc;
            --glass: rgba(255, 255, 255, 0.34);
            --glass-strong: rgba(255, 255, 255, 0.47);
            --surface: rgba(255, 255, 255, 0.38);
            --border: rgba(84, 106, 145, 0.22);
            --border-soft: rgba(84, 106, 145, 0.15);
            --text: #17213a;
            --text-soft: #4d618f;
            --accent: #2563eb;
            --accent-strong: #1e4fd0;
            --success: #0f9f71;
            --danger: #e23b5d;
            --shadow: 0 16px 35px rgba(30, 46, 86, 0.14);
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }
        html, body { height: 100%; overflow: hidden; }

        body {
            font-family: Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: radial-gradient(circle at 12% 8%, rgba(91, 162, 255, 0.16), transparent 35%), var(--bg);
            color: var(--text);
            transition: background 260ms ease, color 260ms ease;
        }

        .app-shell { position: relative; width: 100%; height: 100%; }

        .glass-panel {
            background: var(--glass);
            border: 1px solid var(--border);
            box-shadow: var(--shadow);
            backdrop-filter: blur(var(--blur)) saturate(1.25) contrast(1.06);
            -webkit-backdrop-filter: blur(var(--blur)) saturate(1.25) contrast(1.06);
            position: relative;
            overflow: hidden;
            isolation: isolate;
        }

        .glass-panel::before {
            content: "";
            position: absolute;
            inset: 0;
            background: linear-gradient(130deg, rgba(255, 255, 255, 0.34), rgba(255, 255, 255, 0.03) 36%, rgba(255, 255, 255, 0.16) 100%);
            opacity: 0.45;
            pointer-events: none;
            z-index: -1;
        }

        [data-theme="light"] .glass-panel::before {
            opacity: 0.62;
            background: linear-gradient(130deg, rgba(255, 255, 255, 0.62), rgba(255, 255, 255, 0.16) 40%, rgba(255, 255, 255, 0.35) 100%);
        }

        .top-island {
            position: absolute;
            top: 14px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 1000;
            width: min(860px, calc(100% - 26px));
            border-radius: calc(var(--radius) + 4px);
            padding: 10px 12px;
            display: flex;
            align-items: center;
            justify-content: space-between;
            gap: 10px;
            animation: slideDown 350ms ease;
        }

        .brand {
            display: flex;
            flex-direction: column;
            min-width: 190px;
        }

        .brand h1 {
            font-size: clamp(0.98rem, 2vw, 1.15rem);
            font-weight: 700;
            line-height: 1.1;
        }

        .brand p {
            font-size: 0.72rem;
            color: var(--text-soft);
            margin-top: 2px;
        }

        .action-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .icon-btn {
            width: 38px;
            height: 38px;
            border-radius: 10px;
            border: 1px solid var(--border-soft);
            background: var(--surface);
            color: var(--text);
            display: inline-flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1rem;
            transition: transform 180ms ease, border-color 180ms ease, background 180ms ease;
        }

        .icon-btn:hover {
            transform: translateY(-1px);
            border-color: var(--accent);
            background: var(--glass-strong);
        }

        #map {
            position: absolute;
            inset: 0;
            filter: saturate(1.07) contrast(1.02);
        }

        .sidebar {
            position: absolute;
            top: 76px;
            left: 14px;
            width: min(420px, calc(100% - 28px));
            bottom: 14px;
            border-radius: calc(var(--radius) + 2px);
            z-index: 998;
            transform: translateX(calc(-100% - 26px));
            transition: transform 280ms ease;
        }

        .sidebar.open { transform: translateX(0); }
        .sidebar-header { display: flex; justify-content: flex-end; padding: 12px 12px 0; }
        .close-btn {
            width: 34px;
            height: 34px;
            border-radius: 10px;
            border: 1px solid var(--border-soft);
            background: var(--surface);
            color: var(--text);
            font-size: 1.15rem;
            cursor: pointer;
        }
        .sidebar-content { padding: 8px 22px 22px; overflow-y: auto; max-height: calc(100% - 44px); }

        .place-title { font-size: clamp(1.15rem, 2.6vw, 1.5rem); margin-bottom: 14px; }
        .user-review {
            background: var(--surface);
            border: 1px solid var(--border-soft);
            border-radius: var(--radius);
            padding: 14px;
            line-height: 1.55;
            color: var(--text-soft);
            margin-bottom: 16px;
            font-style: italic;
        }

        .section { margin-bottom: 16px; }
        .section h3 { font-size: 0.72rem; text-transform: uppercase; letter-spacing: 0.08em; margin-bottom: 8px; }
        .pros h3 { color: var(--success); }
        .cons h3 { color: var(--danger); }
        .section ul { list-style: none; display: grid; gap: 7px; }
        .section li {
            padding: 9px 10px 9px 28px;
            background: var(--surface);
            border: 1px solid var(--border-soft);
            border-radius: 10px;
            color: var(--text-soft);
            position: relative;
            line-height: 1.45;
        }
        .pros li::before, .cons li::before { position: absolute; left: 10px; top: 8px; font-weight: 700; }
        .pros li::before { content: "‚úì"; color: var(--success); }
        .cons li::before { content: "‚úï"; color: var(--danger); }

        .gmaps-link {
            display: inline-block;
            margin-top: 8px;
            padding: 9px 15px;
            border-radius: 10px;
            background: var(--accent);
            color: #fff;
            text-decoration: none;
            font-size: 0.86rem;
            font-weight: 600;
        }
        .gmaps-link:hover { background: var(--accent-strong); }

        .distance-display {
            position: absolute;
            bottom: 16px;
            left: 50%;
            transform: translateX(-50%);
            z-index: 999;
            min-width: 175px;
            text-align: center;
            padding: 10px 16px;
            border-radius: calc(var(--radius) + 2px);
            border: 1px solid var(--border);
            background: var(--glass);
            box-shadow: var(--shadow);
            backdrop-filter: blur(var(--blur)) saturate(1.2);
            -webkit-backdrop-filter: blur(var(--blur)) saturate(1.2);
            animation: fadeUp 250ms ease;
        }
        .distance-display h3 {
            text-transform: uppercase;
            font-size: 0.63rem;
            letter-spacing: 0.12em;
            color: var(--text-soft);
            margin-bottom: 4px;
        }
        .distance-value { font-size: 1.35rem; font-weight: 700; color: var(--accent); }

        .leaflet-popup-content-wrapper,
        .leaflet-popup-tip {
            background: var(--glass-strong);
            border: 1px solid var(--border);
            color: var(--text);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
        }
        .popup-title { font-weight: 700; margin-bottom: 8px; }
        .popup-btn {
            border: none;
            border-radius: 8px;
            background: var(--accent);
            color: #fff;
            padding: 8px 14px;
            font-weight: 600;
            cursor: pointer;
        }

        @media (max-width: 930px) {
            .top-island { width: calc(100% - 20px); top: 10px; left: 10px; transform: none; }
            .brand p { display: none; }
            .sidebar { top: 72px; left: 10px; bottom: 10px; width: calc(100% - 20px); }
        }

        @media (max-width: 700px) {
            .top-island { justify-content: space-between; }
            .brand { min-width: 0; }
            .sidebar { top: 70px; }
        }

        @media (prefers-reduced-motion: reduce) { * { transition: none !important; animation: none !important; } }
        @keyframes slideDown { from { opacity: 0; transform: translate(-50%, -8px); } to { opacity: 1; transform: translate(-50%, 0); } }
        @media (max-width: 930px) { @keyframes slideDown { from { opacity: 0; transform: translateY(-8px); } to { opacity: 1; transform: translateY(0); } } }
        @keyframes fadeUp { from { opacity: 0; transform: translate(-50%, 7px); } to { opacity: 1; transform: translate(-50%, 0); } }
    </style>
</head>
<body>
    <div class="app-shell">
        <header class="top-island glass-panel">
            <div class="brand">
                <h1>Mishti's Recommendations</h1>
                <p>Curated spots around New Town & Salt Lake</p>
            </div>

            <div class="action-row">
                <button class="icon-btn" id="theme-toggle" type="button" title="Toggle dark or light mode" aria-label="Toggle dark or light mode">üåô</button>
                <button class="icon-btn" onclick="clearPins()" title="Clear measurement pins" aria-label="Clear measurement pins">üóëÔ∏è</button>
            </div>
        </header>

        <div id="map"></div>

        <aside class="sidebar glass-panel" id="sidebar" aria-live="polite">
            <div class="sidebar-header">
                <button class="close-btn" onclick="closeSidebar()" aria-label="Close details panel">√ó</button>
            </div>
            <div class="sidebar-content" id="sidebar-content"></div>
        </aside>

        <div id="distance-container"></div>
    </div>

    <script>
        const places = [
            { name: "Central Park Salt Lake", lat: 22.583938, lng: 88.416204, userReview: "Ok so if he wants good environment in salt lake Its central park it has good views with peace", pros: ["Beautiful green spaces and walking paths", "Peaceful environment with good views", "Well-maintained park facilities", "Great for morning walks and evening strolls"], cons: ["Can get crowded on weekends", "Limited parking space", "Entry fee required"] },
            { name: "Eco Park New Town", lat: 22.600488, lng: 88.470768, userReview: "And in newtown it would be eco park it has the 7 wonders peaceful sitting areas and photogenic places like a flower garden", pros: ["Features replicas of 7 wonders of the world", "Beautiful flower gardens and photogenic spots", "Peaceful sitting areas throughout", "Large area with diverse attractions", "Boating facilities available"], cons: ["Very crowded on holidays", "Food options are limited inside"] },
            { name: "Axis Mall (with Chinese Caf√©)", lat: 22.5796041, lng: 88.4599513, userReview: "Thora posh mein jaana hai he can explore axis and city centre malls it has many good outlets to eat. There is this very good small cafe in axis mall it is chinese and the food is very good", pros: ["Excellent Chinese caf√© with great food", "Wide variety of dining and shopping options", "Modern mall with good ambiance", "Ample parking space", "Air-conditioned comfort"], cons: ["Can be expensive", "Crowded during weekends", "Small Chinese caf√© can have waiting time"] },
            { name: "City Centre 2", lat: 22.622954, lng: 88.449917, userReview: "Thora posh mein jaana hai he can explore axis and city centre malls it has many good outlets to eat", pros: ["Premium shopping destination", "Excellent food court and restaurants", "Multiplex cinema", "Well-maintained facilities", "Good brands and outlets"], cons: ["Premium pricing", "Heavy traffic during peak hours", "Parking can be challenging on weekends"] },
            { name: "Kosha Koshe Chinar Park", lat: 22.625047, lng: 88.438756, userReview: "Bengali cuisine khaana hai he can go to kosha koshe in chinaar park", pros: ["Authentic Bengali cuisine", "Good quality traditional food", "Reasonable pricing", "Popular local restaurant"], cons: ["Can be crowded during lunch/dinner", "Limited seating capacity", "Waiting time during peak hours"] },
            { name: "Nalban Boating Complex", lat: 22.568554, lng: 88.430920, userReview: "There is one nalban boating complex like a restaurant with a lake view its very peaceful", pros: ["Beautiful lake views", "Very peaceful environment", "Boating facilities available", "Restaurant with scenic setting", "Good for relaxation"], cons: ["Limited food menu", "Boating charges apply", "Can be hot during summer afternoons"] },
            { name: "The Green House Caf√© (Behind Hidco Bhawan)", lat: 22.580097, lng: 88.473352, userReview: "If cafes with privacy he can ho to the green house it is behind hidco bhawan it is ver peaceful and quite", pros: ["Very peaceful and quiet atmosphere", "Good privacy for conversations", "Nice ambiance with greenery", "Quality caf√© offerings"], cons: ["Slightly hidden location", "Limited seating capacity", "Can be pricey for a caf√©"] },
            { name: "Prinsep Ghat Park", lat: 22.558902, lng: 88.332888, userReview: "I would have suggested princep ghat and victoria but that is in old Kolkata", pros: ["Riverside location", "Great for photography", "Great for couples"], cons: ["Located in Old Kolkata", "Heavy traffic getting there", "Hostility"] },
            { name: "Mishti's College (St. Xavier's University)", lat: 22.56074, lng: 88.48801, userReview: "This is where Mishti studies! St. Xavier's University in Action Area III, New Town.", pros: ["PROS JAAN KAR KYA KROGE"], cons: ["CONS?"] }
        ];

        const map = L.map('map').setView([22.5726, 88.4639], 13);
        const lightTileLayer = L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { attribution: '¬© OpenStreetMap contributors', maxZoom: 19 });
        const darkTileLayer = L.tileLayer('https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png', { attribution: '¬© OpenStreetMap contributors ¬© CARTO', maxZoom: 19 });

        let activeTileLayer = null;
        let customPins = [];
        let customMarkers = [];
        let distanceLine = null;
        const placeMarkers = [];

        const themeToggle = document.getElementById('theme-toggle');
        const savedTheme = localStorage.getItem('mishti-theme');
        const preferredTheme = savedTheme || (window.matchMedia('(prefers-color-scheme: light)').matches ? 'light' : 'dark');

        function applyTheme(theme) {
            document.documentElement.setAttribute('data-theme', theme);
            localStorage.setItem('mishti-theme', theme);
            themeToggle.textContent = theme === 'dark' ? 'üåô' : '‚òÄÔ∏è';

            if (activeTileLayer) map.removeLayer(activeTileLayer);
            activeTileLayer = theme === 'dark' ? darkTileLayer : lightTileLayer;
            activeTileLayer.addTo(map);

            redrawDistanceLine();
            updateDistanceDisplay();
            refreshMarkerStyles(theme);
        }

        themeToggle.addEventListener('click', () => {
            const currentTheme = document.documentElement.getAttribute('data-theme') || 'dark';
            applyTheme(currentTheme === 'dark' ? 'light' : 'dark');
        });

        function pinHtml(color, borderColor, size, shadow) {
            return `<div style="
                background:${color}; width:${size}px; height:${size}px;
                border-radius:50% 50% 50% 0; transform:rotate(-45deg);
                border:2px solid ${borderColor}; box-shadow:${shadow};
            "></div>`;
        }

        function getBlueIcon(theme) {
            const border = theme === 'dark' ? '#0b1020' : '#ffffff';
            return L.divIcon({ className: 'custom-div-icon', html: pinHtml('#3f84ff', border, 28, '0 6px 14px rgba(37, 99, 235, 0.45)'), iconSize: [28, 28], iconAnchor: [14, 28], popupAnchor: [0, -28] });
        }

        function getRedIcon(theme) {
            const border = theme === 'dark' ? '#0b1020' : '#ffffff';
            return L.divIcon({ className: 'custom-div-icon', html: pinHtml('#ef4444', border, 24, '0 6px 14px rgba(239, 68, 68, 0.4)'), iconSize: [24, 24], iconAnchor: [12, 24], popupAnchor: [0, -24] });
        }

        function refreshMarkerStyles(theme) {
            const blueIcon = getBlueIcon(theme);
            const redIcon = getRedIcon(theme);
            placeMarkers.forEach((marker) => marker.setIcon(blueIcon));
            customMarkers.forEach((marker) => marker.setIcon(redIcon));
        }

        places.forEach((place, index) => {
            const marker = L.marker([place.lat, place.lng], { icon: getBlueIcon(preferredTheme) })
                .addTo(map)
                .bindPopup(`<div class="popup-title">${place.name}</div><button class="popup-btn" onclick="showPlaceDetails(${index})">View Details</button>`);

            marker.on('click', () => showPlaceDetails(index));
            placeMarkers.push(marker);
        });

        function showPlaceDetails(index) {
            const place = places[index];
            const gmapsLink = `https://www.google.com/maps/search/?api=1&query=${place.lat},${place.lng}`;
            document.getElementById('sidebar-content').innerHTML = `
                <h2 class="place-title">${place.name}</h2>
                <div class="user-review">${place.userReview}</div>
                <div class="section pros"><h3>Pros</h3><ul>${place.pros.map((pro) => `<li>${pro}</li>`).join('')}</ul></div>
                <div class="section cons"><h3>Cons</h3><ul>${place.cons.map((con) => `<li>${con}</li>`).join('')}</ul></div>
                <a href="${gmapsLink}" target="_blank" class="gmaps-link" rel="noopener noreferrer">Open in Google Maps</a>
            `;
            openSidebar();
            map.flyTo([place.lat, place.lng], 15, { duration: 0.62 });
        }

        function openSidebar() { document.getElementById('sidebar').classList.add('open'); }
        function closeSidebar() { document.getElementById('sidebar').classList.remove('open'); }

        function calculateDistance(lat1, lng1, lat2, lng2) {
            const R = 6371;
            const dLat = (lat2 - lat1) * Math.PI / 180;
            const dLng = (lng2 - lng1) * Math.PI / 180;
            const a = Math.sin(dLat / 2) * Math.sin(dLat / 2) + Math.cos(lat1 * Math.PI / 180) * Math.cos(lat2 * Math.PI / 180) * Math.sin(dLng / 2) * Math.sin(dLng / 2);
            return R * (2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a)));
        }

        function updateDistanceDisplay() {
            const container = document.getElementById('distance-container');
            if (customPins.length < 2) return (container.innerHTML = '');
            const last = customPins[customPins.length - 1];
            const secondLast = customPins[customPins.length - 2];
            const distance = calculateDistance(secondLast.lat, secondLast.lng, last.lat, last.lng);
            container.innerHTML = `<div class="distance-display"><h3>Distance</h3><div class="distance-value">${distance.toFixed(2)} km</div></div>`;
        }

        function trimCustomPinsToLastTwo() {
            while (customPins.length > 2) customPins.shift();
            while (customMarkers.length > 2) map.removeLayer(customMarkers.shift());
        }

        function redrawDistanceLine() {
            if (distanceLine) {
                map.removeLayer(distanceLine);
                distanceLine = null;
            }
            if (customPins.length < 2) return;

            const theme = document.documentElement.getAttribute('data-theme') || 'dark';
            const lineColor = theme === 'dark' ? '#ff688a' : '#e23b5d';
            const last = customPins[customPins.length - 1];
            const secondLast = customPins[customPins.length - 2];

            distanceLine = L.polyline([[secondLast.lat, secondLast.lng], [last.lat, last.lng]], { color: lineColor, weight: 2.4, opacity: 0.92, dashArray: '7 7' }).addTo(map);
        }

        map.on('click', (e) => {
            const pin = { lat: e.latlng.lat, lng: e.latlng.lng };
            customPins.push(pin);
            const theme = document.documentElement.getAttribute('data-theme') || 'dark';
            const marker = L.marker([pin.lat, pin.lng], { icon: getRedIcon(theme) }).addTo(map).bindPopup('<div style="text-align:center"><b>Measurement Pin</b></div>');
            customMarkers.push(marker);
            trimCustomPinsToLastTwo();
            redrawDistanceLine();
            updateDistanceDisplay();
        });

        function clearPins() {
            customPins = [];
            customMarkers.forEach((marker) => map.removeLayer(marker));
            customMarkers = [];
            if (distanceLine) {
                map.removeLayer(distanceLine);
                distanceLine = null;
            }
            updateDistanceDisplay();
        }

        applyTheme(preferredTheme);
    </script>
</body>
</html>
